{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "$id": "https://opentp.dev/schemas/event.schema.json",
  "title": "OpenTrackPlan Event",
  "description": "Schema for OpenTrackPlan event files (.yaml). Note: taxonomy and payload fields are validated by CLI based on opentp.yaml",
  "type": "object",
  "required": ["opentp", "event"],
  "additionalProperties": false,
  "properties": {
    "opentp": {
      "$ref": "version.schema.json"
    },
    "event": {
      "type": "object",
      "description": "Event definition",
      "required": ["key", "taxonomy", "payload"],
      "additionalProperties": false,
      "properties": {
        "key": {
          "type": "string",
          "description": "Unique event identifier, format defined in opentp.yaml"
        },
        "lifecycle": {
          "type": "object",
          "description": "Event lifecycle information",
          "additionalProperties": false,
          "properties": {
            "status": {
              "type": "string",
              "description": "Current event status",
              "enum": ["active", "deprecated", "draft"]
            },
            "deprecatedAt": {
              "type": "string",
              "description": "Date when event was deprecated (ISO 8601)",
              "format": "date"
            },
            "deprecatedReason": {
              "type": "string",
              "description": "Reason for deprecation"
            },
            "replacedBy": {
              "type": "string",
              "description": "Key of the replacement event"
            }
          }
        },
        "taxonomy": {
          "type": "object",
          "description": "Event metadata for organization. Fields defined in opentp.yaml"
        },
        "aliases": {
          "type": "array",
          "description": "Previous event keys (for migration)",
          "items": {
            "type": "object",
            "required": ["key"],
            "additionalProperties": false,
            "properties": {
              "key": {
                "type": "string",
                "description": "Previous event key"
              },
              "deprecated": {
                "type": "object",
                "additionalProperties": false,
                "properties": {
                  "reason": {
                    "type": "string"
                  },
                  "date": {
                    "type": "string",
                    "format": "date"
                  }
                }
              }
            }
          }
        },
        "ignoreChecks": {
          "type": "array",
          "description": "Validation checks to skip for this event",
          "items": {
            "type": "object",
            "required": ["path", "reason"],
            "additionalProperties": false,
            "properties": {
              "path": {
                "type": "string",
                "description": "Path to field to skip validation"
              },
              "reason": {
                "type": "string",
                "description": "Reason for skipping validation"
              }
            }
          }
        },
        "payload": {
          "type": "object",
          "description": "Data sent to analytics platforms",
          "required": ["platforms"],
          "additionalProperties": false,
          "properties": {
            "platforms": {
              "type": "object",
              "description": "Platform-specific payload definitions",
              "additionalProperties": {
                "$ref": "#/definitions/platformPayload"
              }
            }
          }
        }
      }
    }
  },
  "definitions": {
    "platformPayload": {
      "type": "object",
      "description": "Payload definition for a specific platform",
      "required": ["active", "history"],
      "additionalProperties": false,
      "properties": {
        "active": {
          "$ref": "version.schema.json"
        },
        "history": {
          "type": "object",
          "description": "Version history of payload schemas",
          "additionalProperties": {
            "$ref": "#/definitions/payloadVersion"
          }
        }
      }
    },
    "payloadVersion": {
      "type": "object",
      "description": "A specific version of the payload schema",
      "required": ["schema"],
      "additionalProperties": false,
      "properties": {
        "changes": {
          "type": "array",
          "description": "List of changes in this version",
          "items": {
            "type": "string"
          }
        },
        "schema": {
          "type": "object",
          "description": "Field definitions",
          "additionalProperties": {
            "$ref": "field.schema.json"
          }
        }
      }
    }
  }
}
