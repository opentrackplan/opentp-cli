opentp: 2026-01

info:
  title: Coverage Fixture (Valid)
  version: 1.0.0
  description: Fixture covering many spec features with zero validation errors

spec:
  paths:
    events:
      root: /events
      template: "{area}/{priority_level}/{is_internal}/{event}.yaml"
    dictionaries:
      root: /dictionaries

  events:
    key:
      minLength: 3
      maxLength: 160
      pattern: "^[a-z0-9_]+::[a-z0-9_]+::[a-z0-9_]+::[a-z0-9_]+::p[0-9]+::internal-(true|false)$"

    x-opentp:
      keygen:
        template: "{area | slug}::{event | slug}::{verb | slug}::{object | slug}::p{priority_level}::internal-{is_internal}"
        transforms:
          slug:
            - lower
            - trim
            - replace:
                from: " "
                to: "_"
            - truncate: 160

    taxonomy:
      area:
        title: Area
        type: string
        dict: taxonomy/areas
        required: true
      priority_level:
        title: Priority Level
        type: integer
        enum: [1, 2, 3]
        required: true
      is_internal:
        title: Internal Event
        type: boolean
        enum: [true, false]
        required: true
      event:
        title: Event
        type: string
        required: true
      action:
        title: Action
        type: string
        required: true
        maxLength: 100
      action_detail:
        title: Action Detail
        type: string
        required: true
        template: "{verb}::{object}"
        fragments:
          verb:
            title: Verb
            type: string
            required: true
            pattern: "^[a-z]+$"
          object:
            title: Object
            type: string
            required: true
            pattern: "^[a-z ]+$"
      custom_id:
        title: Custom Id
        type: string
        required: false
        x-opentp:
          checks:
            starts-with: "cid_"

    payload:
      targets:
        all: [web, ios, android]
        mobile: [ios, android]
      schema:
        application_id:
          type: string
          dict: data/application_id
          required: true
          valueRequired: true
        event_name:
          type: string
          required: true
        event_category:
          type: string
          required: true
        auth_method:
          type: string
          enum: [email, google, github]
          required: false
        user_id:
          type: string
          required: false
        device_model:
          type: string
          required: false
        step_index:
          type: number
          required: false
        is_internal:
          type: boolean
          required: false
        priority_level:
          type: number
          required: false
        tags:
          type: array
          uniqueItems: true
          items:
            type: string
            minLength: 1
          required: false

    pii:
      kind:
        required: true
        dict: governance/pii-kinds
      masker:
        required: false
      schema:
        owner:
          type: string
          dict: governance/pii-owners
          required: true
        jira:
          type: string
          required: true
          pattern: "^[A-Z]+-[0-9]+$"
        retention_days:
          type: integer
          enum: [0, 7, 30]
          required: false

  targets:
    ios:
      title: iOS
      schema:
        device_model:
          type: string
          required: false
          x-opentp:
            role: shared
